https://us-east-1.student.classrooms.aws.training/class/wVVTm3EciLno5a6RzL1ois

AWS Fundamentals

agility - scale seamlessly, increase innovation.  Optimize costs, Minimize security vulnerabilities. 

BASIC SERVICES - SERVERLESS, networking and content delivery, DB, Security Identity & compliance, Storage, Management n governance, AWS cost and management, Compute & Containers.  
CLOUD FRONT - low-latency and high speed delivery. CDN THAT DELIVERS CONTENT IN A HIGH AVAILABILITY MANNER.  

history - aws started internally in 2002 and 2004 got public with SQS. 2006 relaunched with SQS,EC2 and S3. 47% market share.

AWS INFRA - AWS is global.

1. AWS region - where aws operates.. geographical location containing 2 or more az zones.  min. az zones - 3 and max 6. names - us-east-1, us-west-2. Region is cluster of data centers. Most services are regional. 
2. Availability zones - In region we have AZs and in AZs we have DCs in region.  to provide high availability. having cluster of DCs. cluster of DCs = AZ. Each AZ is seperate and isolated from disasters. one or more discrete DCs with redundant power, networking, & connectivity. ONLY AZ IS SELECTED WHEN THERE IS DEMAND FOR LOW LATENCY, HIGH THROUGHPUT. 
THEY ARE CONNECTED WITH HIGH BANDWIDTH, ULTRA LOW-LATENCY NETWORKING. 
3. DC - AWS services operate within AWS Data centers centers. DC has thousands of servers. DCs are organized into AZs. 
4. Egde locations/Point of presence. content delivered to end users with low latency.

factors affecting region selection - COmpliance Governance, Proximity to customer,  availability of service, Pricing.  (CPAP)

AWS LOCAL ZONES - used to deliver low latency so stored in nearest location to us. reducing latency at compute. usecases - media & entertainment content creation, Realtime gaming. AWS infra at the zone, Local storage and compute engine, Connecting to services in AWS regions. Delivering new low-latency apps. 
Edge locations are going to cache static content, but local zones cache real time.. 
EDGE LOCATIONS - Runs in major cities across the world. Supports AWS Networking Services like Amazon route 53, Cloud front. Edge locations uses cache contents and distributing the content. Edge location then there are multiple edge locations and then regional edge caches. Edge locations are those DCs which cannot be used to provision resources, they are used for caching. 
NOTE : ALL AZs are edge locations, but all edge locations are not azs. 400+ edge locations. caching locations are more.. as there is need for 

AWS has global services - 
IAM, Cloudfront, Route 53, WAF

Most services are region-scoped - EC2, Elastic beanstalk, Lambda, Rekognition.   

AWS WELL-ARCHITECTED FRAMEWORK - helpful to cloud infra on how to architect best practices. 
AWS architect responsiblities - Plan, research and build.  can apply best practices using this. we define workloads. 

AWS WAF - 6 well architected framework pillars (CROPSS)
Cost Optimization  - analyze and attribute expenses. use cost effective resources. 
Reliability - Recover from failure. Scale to increase availability. 
Operational excellance - high availability. can configure uptime.. perform operation with code.
Performance Efficiency - reduce latency. Use serverless architecture. monitoring  
Security - Apply at all layers. use MFA.  LEAST PRIVILEGE UNDER WAF
Sustainability - Understand impact n maximize utilization.


SECURITY --------------------------------------------------------------------------------------
AWS root user or IAM user. (every account will have one root user). Root user has full access to all AWS services. IAM users only perform daily tasks. not to use for day-to-day interactions with AWS. best practice is to use AWS IAM. 
Cannot be restricted in a single account model. 

1. Users can be grouped together within IAM. Groups can contains any user. User can be belong to multiple groups. to give them permission. 

AWS IAM - authenticated(signed into AWS) n authorized(Permissions). Root user will create IAM users and give permission and authorization to IAM.
Create and manage users, groups n roles. 

Principal - make request for an action or operation on an AWS resource. can be person, application, federated user or assumed role. a role that can be temporary permission (an STS(AWS Security token service) will be provided).

IAM users - are users within an aws account. authorized to perform specific aws actions based on permissions. can have admin, developers and architect. 

--- 3 WAYS TO ACCESS AWS ----
AWS CLI n SDK for programmatic access - PROTECTED BY SAME ACCESS KEYS. 
	can be used to call AWS APIs
Management console for GUI - PROTECTED BY PASSWORD + MFA
WE NEED Access key ID (can generate at a time 2), Secret key.
ACCESS KEYS ARE GENERTED THROUGH AWS CONSOLE. users manage their own access key. not be shared to anyone. 

AWS CLI - direct access to public AWS APIs. can develop scripts to manage resources. 
SDK - set of library language specific. Enables to access and manage AWS services. supports programming languages such as .NET, nodejs, js, java, php, ruby, Go, C++.. mobile sdks android IOS. Iot Devices SDK - embedded C, arduino. 
AWS CLI is built on AWS SDK for Python.

-------------AWS CLOUDSHELL----- new feature
can issue all AWS commands. terminal in cloud AWS. same like CLI. by default, it will command in the region you are in. 
but we can fire command in a specific region. can download files directly via cloudshell 

Setting permissions with IAM policies - to give permission policy for a user. 

IAM user groups - assign IAM users to a IAM user group. Attach policies to a IAM USer group that will apply to all users within the user group. 

---IAM ROLES - Some AWS services will need to perform action on our behalf.  to do this, we assign IAM roles to that particular service. 
For example, EC2 might need to do something on AWS. for that we create one IAM user and assign it to that ec2 instance making it as a single entity with some permissions to do that particular operation. Common role - ec2 instance role, lambda func role. 

DELEGATE SET OF PERMISSIONS TO SPECIFIC USERS OR SERVICES. CAN CREATE AN IAM ROLE AND THEN ADD USERS TO THAT ROLE. can do for a temporary role. 

DIFFERENCE BETWEEN USER GROUP AND IAM ROLES. 
USER GROUP WE CREATE PERMISSIONS AND POLICIES FOR THE USER GROUP. NOW IF WE WANT TO ADD SOME EXTRA TEMPORARY PERMISSIONS TO SOME USERS, WE CAN CREATE AN IAM ROLE "DEVOP" AND THEN ASSIGN IT TO THOSE USERS.

ASSUMING A ROLE - use an API call to assume role. 2. return temporary security credentials.

POLICY ASSIGNMENTS - IAM POLICY ASSIGNED TO USERS OR ROLES.. IAM ROLES ARE ASSUMED. 
POLICY - Users or groups can be asisgned JSON documents called as Policy. Policy contains permissions to specific type of services to users..
LPP - LEAST PRIVILEGE PRINCIPLE - user might create new services which can be costly.. so we always give users least privilege.   don't give users more permission than he needs. 

STEPS - WE CREATE USER. ADD USER TO GROUP (if created). we assign permission policies to user group. 
IAM POLICY INHERITTANCE WORKS.  
INLINE POLICY - USER CAN BE ATTACHED TO AN INLINE POLICY WHICH DOESN'T BELONG TO ANY GROUP. 

PASSWORD POLICIES IN AWS IAM ACCOUNT: fixed number of character, upper/lower case specific, number and special character. if not protected, user can possibly change configurations. 
MFA = password of own + security device we own. 
MFA Options - 
1. Virtual MFA device -- 
virtual - google auth(phone only) and authy (multiple device support)..  	p
			
2. Yubikey by YUBICO - 3rd party (universal 2nd factor security key). supports multiple root and IAM users using single security key.
3. Hardware key fob device - 3rd party - provided by gemalto. 
4. Hardware key fob device for AWS government - US -- special key fob - provided by surePassId.    

------------SECURITY TOOLS by IAM - 
1. IAM Credentials report (account level ) - generates report of all users under IAM acocunt and the status of their credentials.
2. IAM Access advisor (user level) - generates report of the permissions to any service granted to a user and  last accessed service by user.. can be used to revise  permission levels. 

Policy types - 1. set max permissions ... .   
				a) IAM permission boundary and b) AWS Org SCP (service control policies)								
				SCPs will create permissions boundary for AWS resources for multiple accounts of multi org.(lot of accounts on high level) whereas Permission Boundary are for groups.....
			   2. Grant permissions ...
					a) IAM identity policies b) IAM resource based policies. 			 
			   Identity based policies are assigned to user groups and roles. resource based policies are assigned to resources.  
			   NOTE: RESOURCE BASED POLICIES are checked for the user or user group when user tries to access that resource. 
IAM policy - 2 types - AWS managed and customer managed. 
Every policy will consist of 5 points - version date, policy allow/deny, list of action you allow/deny, 			   
			   
CAN LIMIT ACTIONS on BOTH IAM PERMISSION BOUNDARY AND IAM BASED IDENTITY BASED POLICIES.  

IAM POLICY STRUCTURE -  consists of:
1. Version - policy language verion usually "2012-10-17".
	ID: identifier for the policy. (optional)
2. Statement : can have an array of statements. (required)
	a. SID - statement id for the statement (optional).
	b. Effect: whether this statement allows or denies access. (Allow, deny)
	c. Principal : User/account/role to which this statement will apply. 
	d. Action: list of actions to be allowed or denied for above principal.
	e. Resource: list of resources to which above actions will be allowed/denied for the mentioned principal.
	f. condition: conditions when this policy will hold true. (optional)
			   
2 types of policies - identity based policies and resource based policies. 

explicit allow and deny - Allows allows policy on a resource. Deny will deny access. 
			   
DEFENSE IN DEPTH - 
USERS - ROLE (IAM - indentity BASED POLICY) - AMAZON VPC S3 ENDPOINT (RESOURCE BASED - VPC ENDPOINT) - S3 BUCKET(BUCKET POLICY - RESOURCE BASED)
NOTE: EVALUATE IDENTITY BASED POLICIES AND RESOURCE BASED TOGETHER. 

TO MANAGE MULTIPLE ACCOUNTS - 

DEVELOP A MULTI-ACCOUNT STRATEGY. refine as business evolves. can do using AWS Organizations. 
AWS ORG - CREATE A HIERARCHY  Management ACCOUNT AND CAN CREATE MULTPLES OUS (org units).  SCPs can be used to create policies. 
without AWS Organizations - use SCPs 

How IAM policies interact with SCPs. SCPs allow what is at the intersection of iam and scps. they acts as filter.
LAYERING ORDER - using policies as layered defense
1. SCP Filter
2. Permission boundary 
3. IDENTITY permission. (grant or deny)

NETWORKING ---------------------------------------------------------------------------

IP addressing - 32 bit.. 4 groups of 8 bit. first 2 number before . identifies networks and last 2 - location of the host. 

Elastic network interface (ENI) --- logical networking component in a VPC that represents a virtual network card. can contain following attributes - private ipv4, One elastic ipv4 per private ipv4 address. one public ipv4.

10.22.0.0/16 - 2 raise to 32-16 = 2 raise to 16 = 65000 addreses.
CIDR - to ensure we have enough IP addresses to support our workloads, classless inter domain routing.. when creating VPCs. CIDR specifies a range of ip network callsed CIDR blocks. 
. to specify network or subnet. Slash notation for subnet mask.
/28 --- 16 total IPs. (32-28) = 2 raise to 4  = 16 total ip addresses. 
16 - maximum. 28 - minimum

VPC FUNDAMENTALS - secure and private network infra. virtual private cloud. 
3 scopes of a resource - global, regional and zonal. 
Global - Cloudfront, route 53
regional - VPC, lambda, gateway, elb, etc.
zonal - EC2, EBS(elastic block storage), SUBNETS
scope define how its consumed. VPC is SDN (software defined networking)
ONE REGION MULTIPLE AZs. Single VPC is not across multiple regions. it can be in single region. 
VPC supports ipv4 and ipv6 ips. ipv4 is mandatory. 
VPC can only have one INTERNET GATEWAY.  

components  in VPC - 

VPC is divided into subnets. subnets are zonal scoped. EACH VPC COMES WITH ROUTE TABLE WHICH IS USED BY DEFAULT BY ALL SUBNETS. 
a subnet will make use of default route table if no route table is allocated. 

---amazon VPC when CIDR is given - logical isolation for your workloads, 
---SUBNETS - SUB RANGE OF IP ADDRESSES. subset of VPC cidr block. its range of IP addresses.  In 1 AZ - there can be multiple subnets - public and private. 
	Subnet CIDR blocks cannot overlap.
	private DB --- can be put in private subnet.. public subnet - where we want customer/users to access so will keep that resource in public subnet. 
EACH SUBNET RESIDES WITHIN ONE AVALABLITY ZONE. 5 addresses are reserved. first 4 addresses and last 1 address are stored for whole VPC. 
-----------PUBLIC SUBNET - HOLDS RESOURCES WITH INBOUND AND OUTBOUND INTERNET TRAFFIC. 
	IT REQUIRES ROUTE TABLE, INTERNET GATEWAY, PUBLIC IP ADDRESSES. 
		1. ROUTE TABLE - SET OF RULES THAT VPC USES to route network traffic. requires a route to internet. route tables to control where network traffic is directed. 
		2. Internet gateway - allows communication between resources in VPC and internet.
		3. IP addresses - to do routing 
		
----INTERNET GATEWAYS - between instances in vpc and internet.  
----------PRIVATE SUBNET - allows indirect access to internet. Private IP never changes. traffic in VPC stays local. 
private subnet will talk to NAT GATEWAY TO TALK TO PUBLIC SUBNET.. IN CASE PUBLIC IP IS NOT ASSIGNED.. TO COMMUNICATE TO INTERNET. IT WILL MAP TO ELASTIC IP. 
NAT is FOR PROTECTING YOUR PRIVATE IP ADDRESSES ... NAT USES ELASTIC IP AS SOURCE IP ADDRESS FOR TRAFFIC FROM THE PRIVATE SUBNET.
NAT SITS IN PUBLIC SUBNET. 

from private subnet, it goes to nat and then routing to public and then to internet gateway.

DIFF -
PUBLIC SUBNET WILL HAVE ENTRY OF INTERNET GATEWAY IN ROUTE TABLE, WHILE PRIVATE SUBNET WILL HAVE NAT GATEWAY ENTRY IN ROUTE TABLE. 

DEFAULT VPCS - PROVISIONED AT ACCOUNT CREATION.. EVERYTHING WILL BE CREATED.

ELASTIC IP addresses - Provides association with an instance or a network. Supports bring your own IP. can be reassociated and direct new traffic immediately. Default restriction of five per region. 

ELASTIC NETWORK INTERFACE - logical networking component in a VPC.. can be moved across resources in same AZ..Maintains its ip addresses, elastic ip addresses. VIRTUAL NETWORK CARD.  

DEPLOY VPC ACROSS MULTIPLE AVAILABILITY ZONES - 
1. 

VPC TRAFFIC SECURITY -  NACL and security groups.
NACLs (Network access control lists) - firewall at the subnet boundary. By default allows all inbound and outbound. it is stateless...requiring explicit rules for traffic. Evaluates rules starting with the lowest numbered rule.  ALLOWS RULES AND DENY RULES. 

Security Groups - we use at instance level.virtual firewall that controls inbound and outbound to AWS resource..Stateful..allows traffic based on IP,  protocol, port. SUPPORTS ALLOW ONLY RULES. 

DEFAULT AND NEW SECURITY GROUP - BY DEFAULT, BLOCKED ALL INBOUND TRAFFIC AND ALLOWED OUTBOUND TRAFFIC. can apply Custom Security group rules.. Inbound all will be blocked. we will have to apply. 

Security Group chaining - can chain Inbound from Web server to app server to Database server while editing inbound rules.

DESIGN INFRA WITH MULTIPLE LAYERS OF DEFENSE. 
 INTERNET GATEWAY  - ROUTE TABLE - NETWORK ACL - PRIVATE SUBNET --- SECURITY GROUPS --- TO INSTANCES. 

COMPARING SGs and ACLs -- nacl will be automatically applied when instances are added to subnet. 


Commands we will fire in EC2 instance:
TO CREATE AN S3 BUCKET. 
aws s3 mb s3://labclibucket-NUMBER

TO LIST FILES IN THE AWS S3
aws s3 ls

TO COPY FILE FROM EC2 INSTANCE TO S3 BUCKET - 
aws s3 cp /home/ssm-user/HappyFace.jpg s3://labclibucket-NUMBER

to list files from S3 bucket -
aws s3 ls bucketname   or aws s3 ls s3://labclibucket-NUMBER

